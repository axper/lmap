# Սերվերային համակարգերում անվտանգությունը գնահատող ծրագրի մշակում

# Հապավումներ
- Lmap - Լոկալ Nmap
- TCP - Փոխանցման կառավարման հաղորդակարգ
- UDP - ??
- IDS - ներխուժում հայտնաբերող համակարգ
- psutil - ??

# Ներածություն

## Սերվերային համակարգերում խոցելիությունների հայտնաբերման ներկայիս մոտեցումը
Համակարգերի ադմինիստրատորների առօրյա խնդիրներից է իրենց վստահված համակարգերում պորտ սկանավորման իրականացումը։
Պորտ սկանավորումը օգնում է ադմինիստրատորին հայտնաբերել խոցելիություններ, նախքան դա կարվի հնարավոր հակառակորդի կողմից։
Նման սկանավորման համար ադմինիստրատորները օգտագորում են ծրագրային փաթեթներ ինչպիսիք են՝ nmap, nessus, accunetix և այլն։

Պորտ սկանավորման պրոցեսը սովորաբար անցնում է հետևյալ փուլերով՝

1. Ադմինիստրատորը որոշում է սկանավորելիք հասցեների և պորտերի միջակայքը
2. Նա տալիս է ծրագրին վերոնշյալ տվյալները և գործարկում է ծրագիրը
3. Ծրագիրը փորձարկում է բոլոր հնարավոր IP հասցենե ֊ պորտ համակցությունները
4. Եթե հայտնաբերովում է, որ պորտը բաց է, հատուկ հարցումների շարք է ուղարկվում, որոնց միջոցով ծրագիրը փորձում է գուշակել
թե կոնկրետ ինչ սերվիս է լսում նշված պորտի տակ և նրա մանրամասները (տարբերակ, կոնֆիգուրացիան և այլն)
5. Արդյունքների մասին հաշվետվությունը նեկայացվում է ադմինիստրատորին նախընտրած ֆորմատով (xml, console output, html)

Սակայն նման մոտեցումը ունի որոշակի թերություններ՝

- Յուրաքանչյուր IP հասցոի յուրաքանչյուր TCP և UDP պորտ սկանավորելը պահանջում է երկար ժամանակ
- Սկանավորումը գրավում է ցանցային ռեսուրսները և հնարավոր է որոշ համակարգեր անօգտագործելի դառնան սկանավորման ընթացքում
- Որոշ իրավիճակներում սկանավորումը կարող է անտեղի տագնապի ազդանշան առաջացնել ներխուժում հայտնաբերող համակարգերում։
- Հնարավոր են կեղծ դրական արդյունքներ և սխալ սերվիսների նույնականցումներ
- Եթե սերվիսը աշխատում է անսովոր պորտի տակ, ապա այն հնարավոր է չհայտնաբեվի թռուցիկ սկանավորման եղանակով։

## Այլընտրանք
Այս աշխատությունում մենք ներկայացնում ենք սերվերների խոցելիությունների գնահատման այլընտրանքային եղանակ։ Այն սկանավորում է
համակարգերը ներսից։

Այս ծրագրի գործունեության եղանակը որոշ չափով նման է Microsoft Baseline Security Analyzer ծրագրին:

Ծրագիրը մտածելու տեղ է տալիս օգտագործողին, պարզապես նրան ներկայացնելով նրան փաստեր համակարգի մասին։

Ծրագիրը ավտոմատ եղանակով սկանավորում է համակարգում աշխատող սերվիսները բազմաթիվ հայտնի խոցելիությունների հետ համեմատելով
դրանց կոնֆիգուրացիոն ֆայլեը։

# Ինչպես է այն աշխատում
Սկզբում ծրագիրը հայտնաբերում է համակարգում բոլոր բաց TCP և UDP պորտերը: Հետո յուրաքանչյուր բաց պորտի համար ծրագիրը
սկանավորում է նրա կոնֆիգուրացիոն ֆայլը հայտնի սխալ կարգաբերումների, դատարկ/թույլ գաղտնաբառերի և այլ խոցելիությունների
առկայության համար և հաշվետվություն է ներկայացնում օգտագործողին։

Բացի հայտնաբերելուց թե որոշակի պորտ բաց է թե ոչ, ծրագիրը ստուգում է թե արդյոք այն կասեցված է firewall-ով։

# Տարածվակ կարգաբերման սխալներ
- Դատարկ գաղտնաբառեր
- Սխալ կարգաբերումներ, որոնք կարող են առաջացնել օրինակ՝ path traversal գրոհներ
- Հին/կոտրված հեշերի և գաղտնագրման ալգորիթմների օգտագործում

# Թարմացումներ
Ծրագրի այս հատվածը ստուգում է թե արդյոք համակարգը վերջերս թարմացվել է։ Եթե վերջին թարմացման ժամանակը ուշ է քան նախատեսված է
այս ծրագրի կարգաբերման ֆայլում, օգտագործողը ստանում է նկատողություն։

## Debian/APT-ի վրա հիմնված համակարգեր
[8] Ծրագիրը ստուգում է `/var/cache/apt/` պանակի մեջ վերջին գրման ժամանակը, որպեսզի հայտնաբերի `sudo apt-get update`
հրահանգի վերջին կատարման ժամնակը։

## Red Hat/YUM-ի վրա հիմնված համակարգեր
[9] Ծրագիրը ստուգում է `sudo yum update` հրահանգի կատարման վերջին ժամկետը, վերլուծելով `yum history` հրահանգի
արդյունքը։

## Arch/Pacman֊ի վրա հիմնված համակարգեր
[10] Ծրագիրը ստուգում է `sudo pacman -Syu` հրահանգի վերջին կատարման ժամանակը, վերլուծելով `/var/lob/pacman.log` ֆայլը։

# Root օգտագործողի անմիջական օգտագործում
Եթե օգտագործողը համակարգ է մտել որպես root, կամ ունի ադմինիստրատորի իրավասություններ, ապա ծրագիրը զգուշացնում է օգտագործողին։

Ծրագիրը հաշվի է առնում այն դեպքը, երբ ինքը գործարկվել է `sudo` հրահանգի օգտագործմամբ, և այդ դեպքւմ զգուշացում չի կատարվում։

# Դատարկ գաղնտաբառեր
Այն պարագայւմ երբ համակարգը արտաքինից հասանելի է այնպիսի սերվիսների կողմից, որոնք օգտագործում են տեղային Linux օգտագործողներին
վավերականցման համար, ապա ծրագիրը ստուգում թե արդյոք բոլոր առկա Linux օգտագործողները ունեն ոչ դատարկ գաղնտաբառ։ Սա կատարվում է
հետևյալ հրամանաի օգնությամբ՝

    awk -F: '($2=="") {print}' /etc/shadow

## Ստուգում որ բոլոր ոչ root օգտագործողների UID-n 0 է

[15]

   awk -F: '($3 == "0") {print}' /etc/passwd

# Սերվիսներ

## SSHd
SSH սերվերի կոնֆիգուրացիոն ֆայլը տեղակայված է՝

- /etc/ssh/sshd_config

1. Ամենավտանգավոր կարգաբերման սխալներից է SSH v1 տարբերակի արձանագրության օգատգործումը։ Այս խոցելիութունը նախկինուոմ
խոցվել է WOOT պրոյեկտ կոչվող հաքերային խմբի կողմից։
2. Ստուգում որ գաղտնաբառով մուտք չի թույլատրվում։ Այս ստուգումը կատարվում է սկանավորելով SSH կարգաբերման ֆայլը հետևյալ
տողի առկայության համար՝

    PasswordAuthentication no

## MySQL
MySQL-ը ամենատարածված ռելացիոն բազաներից է աշխարհում[4]
Ծրագիրը սկանավորում է հետևյալ կոնֆիգուրացիոն ֆայլերը սխալների համար՝

- /etc/my.cnf
- /etc/mysql/my.cnf
- ~/.my.cnf

## Telnet
Եթե հայտնաբերվում է աշխատող telnet սերվեր, ապա օգտագործողը զգուշացվում է։

## FTP
Եթե FTP սերվիս է աշխատում, որը անանուն և միայն կարդացվող չե, ապա օգտագործողը զգուշացվում է FTP արձանագրության օգտագործման
դեմ։ FTP արձանագրությունը ապահով չէ, քանի որ գաղտնաբառը ուղարկվում է բացիեբաց։
If running FTP daemon is not:

# Apache HTTPD

# Requirements
Ծրագրի աշխատանքի համար անհրաժեշտ է՝

- Python 3.5.1
- psutil library

# Sources:
[1]http://sectools.org/
[2]https://docs.python.org/2/library/socket.html
[3]https://pythonhosted.org/psutil/
[4]http://db-engines.com/en/ranking
[5]http://www.yolinux.com/TUTORIALS/LinuxTutorialInternetSecurity.html
[6]http://www.yolinux.com/TUTORIALS/LinuxTutorial-woot-project.html
[7]http://www.iss.net/threats/advise100.html
[8]http://serverfault.com/questions/20747/find-last-time-update-was-performed-with-apt-get
[9]http://serverfault.com/questions/389650/how-to-check-when-yum-update-was-last-run
[10]https://bbs.archlinux.org/viewtopic.php?id=150428
[11]https://www.digitalocean.com/community/tutorials/7-security-measures-to-protect-your-servers
[12]http://askubuntu.com/questions/16178/why-is-it-bad-to-login-as-root
[13]http://www.tecmint.com/linux-server-hardening-security-tips/
[14]https://www.digitalocean.com/community/tutorials/an-introduction-to-securing-your-linux-vps
[15]http://www.cyberciti.biz/tips/linux-security.html
